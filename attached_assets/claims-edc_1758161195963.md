version: 2

models:
  - name: contract

    description: "The Contract concept contains reference data for the contracts implemented within each source in the Claims EDC."

    access: public

    versions:
      - v: 1

    config:
      contract:
        enabled: true

    constraints:
      - type: primary_key
        columns: [contract_key]

    columns:
      # KEYS
      - name: contract_key
        description: "How the business would refer to the row. Generally this is the source identifier."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - unique
          - not_null

      # ATTRIBUTES
      - name: source_instance_id
        description: "The source instance identifier."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: contract_hierarchy_level_01
        description: "Hierarchical classification of the contract used for reporting.  This is the top-level (broadest) category.  Required."
        data_type: string

      - name: contract_hierarchy_level_02
        description: "Hierarchical classification of the contract used for reporting.  This is the mid-level category.  Optional, but the number of levels should be implemented in the same manner across all of a tenant's claim sources."
        data_type: string

      - name: contract_hierarchy_level_03
        description: "Hierarchical classification of the contract used for reporting.  This is the mid-level category.  Optional, but the number of levels should be implemented in the same manner across all of a tenant's claim sources."
        data_type: string

      - name: contract_hierarchy_level_04
        description: "Hierarchical classification of the contract used for reporting.  This is the mid-level category.  Optional, but the number of levels should be implemented in the same manner across all of a tenant's claim sources."
        data_type: string

      - name: contract_hierarchy_level_05
        description: "Hierarchical classification of the contract used for reporting.  This is the lowest-level (most granular) category.  Optional, but the number of levels should be implemented in the same manner across all of a tenant's claim sources."
        data_type: string

      - name: organization_code
        description: "The code for the organization associated with the contract."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: payer_code
        description: "The code for the payer associated with the contract."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: line_of_business
        description: "The line of business associated with the contract (e.g., Commercial, Medicare, Medicaid, etc.)."
        data_type: string

      - name: plan_name
        description: "The specific plan associated with the contract (e.g., HMO, PPO, etc.)."
        data_type: string

      - name: is_medicare
        description: "Indicates a Medicare contract (Original Medicare, Medicare Supplement, Medicare Advantage)."
        data_type: boolean

      # CODED VALUES
      - name: attribute_01
        description: "Attribute of the contract.  This field is optional and customizable, but it should be implemented in the same manner across all of a tenant's claim sources.  The system indicates the attribute name."
        data_type: "struct<code: string, system: string, description: string>"

      - name: attribute_02
        description: "Attribute of the contract.  This field is optional and customizable, but it should be implemented in the same manner across all of a tenant's claim sources.  The system indicates the attribute name."
        data_type: "struct<code: string, system: string, description: string>"

      - name: attribute_03
        description: "Attribute of the contract.  This field is optional and customizable, but it should be implemented in the same manner across all of a tenant's claim sources.  The system indicates the attribute name."
        data_type: "struct<code: string, system: string, description: string>"

      - name: attribute_04
        description: "Attribute of the contract.  This field is optional and customizable, but it should be implemented in the same manner across all of a tenant's claim sources.  The system indicates the attribute name."
        data_type: "struct<code: string, system: string, description: string>"

      - name: attribute_05
        description: "Attribute of the contract.  This field is optional and customizable, but it should be implemented in the same manner across all of a tenant's claim sources.  The system indicates the attribute name."
        data_type: "struct<code: string, system: string, description: string>"

      - name: attribute_06
        description: "Attribute of the contract.  This field is optional and customizable, but it should be implemented in the same manner across all of a tenant's claim sources.  The system indicates the attribute name."
        data_type: "struct<code: string, system: string, description: string>"

      - name: attribute_07
        description: "Attribute of the contract.  This field is optional and customizable, but it should be implemented in the same manner across all of a tenant's claim sources.  The system indicates the attribute name."
        data_type: "struct<code: string, system: string, description: string>"

      - name: attribute_08
        description: "Attribute of the contract.  This field is optional and customizable, but it should be implemented in the same manner across all of a tenant's claim sources.  The system indicates the attribute name."
        data_type: "struct<code: string, system: string, description: string>"

      - name: attribute_09
        description: "Attribute of the contract.  This field is optional and customizable, but it should be implemented in the same manner across all of a tenant's claim sources.  The system indicates the attribute name."
        data_type: "struct<code: string, system: string, description: string>"

      - name: attribute_10
        description: "Attribute of the contract.  This field is optional and customizable, but it should be implemented in the same manner across all of a tenant's claim sources.  The system indicates the attribute name."
        data_type: "struct<code: string, system: string, description: string>"

      # METADATA
      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp

      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp
version: 2

models:
  - name: encounter

    access: public

    versions:
      - v: 1

    config:
      enabled: true

    constraints:
      - type: primary_key
        columns: [encounter_key]
      - type: foreign_key
        columns: [member_key, contract_key]
        to: ref('member')
        to_columns: [member_key, contract_key]
      - type: foreign_key
        columns: [contract_key]
        to: ref('contract')
        to_columns: [contract_key]

    description: >
      This table provides a comprehensive view of patient encounters,
      including details on claims, provider information, and various flags
      indicating the nature of the encounter. It includes key identifiers for
      encounters, members, and contracts, as well as details on payer hierarchy,
      and claim type.

    columns:
      # KEYS
      - name: encounter_key
        description: "Uniquely identifies the encounter over a member, provider, claim type, claim dates, and other attributes depending on the claim category."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null
          - unique

      - name: member_key
        description: "Uniquely identifies the member."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: contract_key
        description: "Contract ID associated with member enrollment."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # DATES
      - name: start_date
        description: "Encounter start date."
        data_type: date

      - name: end_date
        description: "Encounter end date."
        data_type: date

      - name: encounter_year
        description: "Encounter year number."
        data_type: int

      - name: encounter_month
        description: "Encounter month number."
        data_type: int

      # OPERATIONAL CODES
      - name: claim_category
        description: "Category of claim being submitted through the payer's processing system."
        data_type: "struct<code: string, description: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: claim_type_code
        description: "Type of claim being submitted through the payer's processing system."
        data_type: "struct<value: string, system: string, description: string, level_01: string, level_02: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: discharge_status_code
        description: "Discharge status code and description."
        data_type: "struct<value: string, system:string, description: string>"

      # FLAGS
      - name: is_network_provider
        description: "Flag indicating whether the claim line item took place at a network provider."
        data_type: int

      - name: is_inpatient_admit
        description: "Flag indicating whether the encounter was an inpatient admission.  Inpatient hospital admissions are identified by a ClaimTypeCD = 100, though rehab hospitals and subunits are excluded from being flagged."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # FINANCIALS
      - name: paid_amount
        description: "Amount paid for the service or product."
        data_type: decimal(10,2)

      # METADATA
      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp

      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp
#  <#Title#>

version: 2

models:
  - name: encounter_item

    description: "The encounter_item table contains detailed information about individual services or items within a healthcare encounter, including codes, descriptions, and financial data."

    access: public

    versions:
      - v: 1

    config:
      enabled: true

    constraints:
      - type: primary_key
        columns: [encounter_item_key]
      - type: foreign_key
        columns: [encounter_key]
        to: ref('encounter')
        to_columns: [encounter_key]
      - type: foreign_key
        columns: [member_key, contract_key]
        to: ref('member')
        to_columns: [member_key, contract_key]
      - type: foreign_key
        columns: [contract_key]
        to: ref('contract')
        to_columns: [contract_key]

    columns:
      # KEYS
      - name: encounter_item_key
        description: "Encounter item key associated with the claim line item."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null
          - unique

      - name: encounter_key
        description: "Encounter key associated with the claim line item."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_key
        description: "Uniquely identifies the member."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: contract_key
        description: "Contract key associated with member enrollment."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: billing_provider_key
        description: "The provider key of the billing provider."
        data_type: string

      # DATES
      - name: encounter_start_date
        description: "Encounter start date."
        data_type: date

      - name: encounter_end_date
        description: "Encounter end date."
        data_type: date

      - name: encounter_line_start_date
        description: "Encounter line start date."
        data_type: date

      - name: encounter_line_end_date
        description: "Encounter line end date."
        data_type: date

      - name: encounter_month
        description: "Encounter month number."
        data_type: int

      - name: encounter_year
        description: "Encounter year number."
        data_type: int

      # PROVIDERS
      - name: billing_provider_info
        description: "The National Provider Identifier (NPI) and tax identification number of the billing provider."
        data_type: "struct<npi: string, tax_identification_number: string, specialty: string>"

      # TERMINOLOGY CODES
      - name: principal_diagnosis_code
        description: "Principal ICD diagnosis."
        data_type: "struct<value: string, system: string, description: string>"

      - name: principal_procedure_code
        description: "Principal ICD procedure."
        data_type: "struct<value: string, system: string, description: string>"

      - name: aprdrg_code
        description: "All Patients Refined Diagnosis Related Groups (APR DRG) code and description associated with the claim line item."
        data_type: "struct<value: string, system: string, description: string>"

      - name: msdrg_code
        description: "Medicare Severity-Diagnosis Related Group (MS-DRG) code and description associated with the claim line item."
        data_type: "struct<value: string, system: string, description: string>"

      # OPERATIONAL CODES
      - name: care_process_code
        description: "A Care Process Family is a group of related Care Processes; Care Process Families represent the middle level of the HC clinical hierarchy."
        data_type: "struct<value: string, system: string, family: string, sub: string>"

      - name: clinical_program
        description: "Clinical Programs are the highest level of the HC clinical hierarchy and represent the service lines that exist within an organization."
        data_type: string

      - name: claim_category_code
        description: "Category of claim being submitted through the payer's processing system."
        data_type: "struct<value: string, system: string, description: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: claim_type_code
        description: "Type of claim being submitted through the payer's processing system."
        data_type: "struct<value: string, system: string, description: string, level_01: string, level_02: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      # FLAGS
      - name: is_network_provider
        description: "Flag indicating whether the claim line item took place at a network provider."
        data_type: int

      - name: is_inpatient_admit
        description: "Flag indicating whether the encounter was an inpatient admission."
        data_type: int

      # FINANCIALS
      - name: paid_amount
        description: "Amount paid for the service or product."
        data_type: decimal(10,2)

      # METADATA
      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp

      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp
version: 2

models:
  - name: encounter_item_diagnosis

    description: >
      "This model contains encounter-specific diagnosis information, linking to various clinical and organizational details like payer
       and care process codes. It also includes flags for principal diagnoses and timestamps for metadata tracking."

    access: public

    versions:
      - v: 1

    config:
      enabled: true

    constraints:
      - type: primary_key
        columns: [encounter_item_key, diagnosis_code]
      - type: foreign_key
        columns: [encounter_item_key]
        to: ref('encounter_item')
        to_columns: [encounter_item_key]
      - type: foreign_key
        columns: [member_key, contract_key]
        to: ref('member')
        to_columns: [member_key, contract_key]
      - type: foreign_key
        columns: [contract_key]
        to: ref('contract')
        to_columns: [contract_key]

    # tests:
    #   - dbt_utils.unique_combination_of_columns:
    #       combination_of_columns:
    #         - encounter_item_key
    #         - diagnosis_code

    columns:
      # KEYS
      - name: encounter_item_key
        description: "Encounter item ID associated with the claim line item."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_key
        description: "Uniquely identifies the member."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: contract_key
        description: "Contract ID associated with member enrollment."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # TERMINOLOGY CODES
      - name: diagnosis_code
        description: "ICD diagnosis code and description."
        data_type: "struct<value: string, system: string, description: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      # OPERATIONAL CODES
      - name: clinical_program_name
        description: "Clinical Programs are the highest level of the HC clinical hierarchy and represent the service lines that exist within an organization."
        data_type: string

      - name: care_process_family_name
        description: "A Care Process Family is a group of related Care Processes; Care Process Families represent the middle level of the HC clinical hierarchy."
        data_type: string

      - name: care_process_name
        description: >
          "A Care Process is a key work process, a condition whose management is central to the work of the healthcare organization;
          Care Processes represent the lowest level of the HC clinical hierarchy. Clinical elements within the claim data (e.g., diagnoses) are used to map to the appropriate Care Process."
        data_type: string

      # FLAGS
      - name: is_principal_diagnosis
        description: "Flag indicating that this diagnosis is the principal diagnosis code."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # METADATA
      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp

      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp
version: 2

models:
  - name: medical_claim

    description: The Claim Item concept contains claim row records associated with a Medical Claim record that itemize the services rendered.

    access: public

    versions:
      - v: 1

    config:
      enabled: true

    constraints:
      - type: primary_key
        columns: [contract_key, medical_claim_key]
      - type: foreign_key
        columns: [encounter_key]
        to: ref('encounter')
        to_columns: [encounter_key]
      - type: foreign_key
        columns: [member_key, contract_key]
        to: ref('member')
        to_columns: [member_key, contract_key]
      - type: foreign_key
        columns: [contract_key]
        to: ref('contract')
        to_columns: [contract_key]

    # tests:
    #   - dbt_utils.unique_combination_of_columns:
    #       combination_of_columns:
    #         - contract_key
    #         - medical_claim_key

    columns:
      # KEYS
      - name: contract_key
        description: "Contract Key."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: medical_claim_key
        description: "Claim Key."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: encounter_key
        description: "Uniquely identifies the encounter."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_key
        description: "Uniquely identifies the member."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: billing_provider_key
        description: "The provider key of the billing provider."
        data_type: string

      - name: attending_provider_key
        description: "The provider key of the attending provider."
        data_type: string

      - name: operating_provider_key
        description: "The provider key of the operating provider."
        data_type: string

      - name: ordering_provider_key
        description: "The provider key of the ordering provider."
        data_type: string

      # TERMINOLOGY CODES
      - name: bill_type_code
        description: "Bill type code. First digit: facility, second digit: classification, third digit: frequency."
        data_type: "struct<value: string, system: string, description: string>"

      - name: principal_diagnosis_code
        description: "Principal ICD diagnosis."
        data_type: "struct<value: string, system: string, description: string>"

      - name: principal_procedure_code
        description: "Principal ICD procedure."
        data_type: "struct<value: string, system: string, description: string>"

      - name: aprdrg_code
        description: "All Patients Refined Diagnosis Related Groups"
        data_type: "struct<value: string, system: string, description: string>"

      - name: msdrg_code
        description: "Medicare Severity-Diagnosis Related Group (MS-DRG) code associated with the claim."
        data_type: "struct<value: string, system: string, description: string>"

      - name: mdc_code
        description: "Major Diagnostic Category, a group of similar diagnosis-related groups, such as all those affecting a given organ system of the body."
        data_type: "struct<value: string, system: string, description: string>"

      # DATES
      - name: claim_start_date
        description: "Claim start date."
        data_type: date

      - name: claim_end_date
        description: "Claim end date."
        data_type: date

      - name: admission_date
        description: "On an institutional claim, the date the patient was admitted to the hospital, skilled nursing facility."
        data_type: date

      - name: discharge_date
        description: "On an institutional claim, the date the patient was discharged from the hospital, skilled nursing facility."
        data_type: date

      # OPERATIONAL VALUES
      - name: admission_type_code
        description: "Type of admission (e.g., emergency, elective)."
        data_type: "struct<value: string, system: string, description: string>"

      - name: admission_source_code
        description: "Indicates the source of the beneficiary referral for admission or visit (e.g., a physician or another facility)."
        data_type: "struct<value: string, system: string, description: string>"

      - name: discharge_code
        description: "Discharge status."
        data_type: "struct<value: string, system: string, description: string>"

      - name: claim_type_code
        description: "Type of claim being submitted through the payer's processing system."
        data_type: "struct<value: string, system: string, description: string, level_01: string, level_02: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: original_claim_type_code
        description: "The original claim type that came from the claim source if it exists.  For many commerical sources this will be null."
        data_type: "struct<value: string, system: string, description: string>"

      # PROVIDERS
      - name: billing_provider_info
        description: "Billing provider information including NPI, tax identification number, and specialty."
        data_type: "struct<npi: string, tax_identification_number: string, specialty: string>"

      # FINANCIALS
      - name: charge_amount
        description: "Amount charged for the service or product."
        data_type: decimal(10,2)

      - name: allowed_amount
        description: "Maximum amount a plan will pay for a service."
        data_type: decimal(10,2)

      - name: paid_amount
        description: "Amount paid for the service or product."
        data_type: decimal(10,2)

      - name: coinsurance_amount
        description: "Amount the patient and insurance plan pay towards a service."
        data_type: decimal(10,2)

      - name: copay_amount
        description: "Fixed amount payed by a patient for a covered service."
        data_type: decimal(10,2)

      - name: deductible_amount
        description: "Amount of money payed before insurance coverage starts."
        data_type: decimal(10,2)

      - name: is_inpatient_admit
        description: "Flag indicating whether the encounter was an inpatient admission."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # METADATA
      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp

      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp
version: 2

models:
  - name: medical_claim_diagnosis

    description: "The Claim Diagnosis table contains information about diagnoses associated with claims, including details about the member, payer, and various clinical classifications."

    access: public

    versions:
      - v: 1

    config:
      enabled: true

    constraints:
      - type: primary_key
        columns: [contract_key, medical_claim_key, diagnosis_sequence]
      - type: foreign_key
        columns: [contract_key, medical_claim_key]
        to: ref('medical_claim')
        to_columns: [contract_key, medical_claim_key]
      - type: foreign_key
        columns: [member_key, contract_key]
        to: ref('member')
        to_columns: [member_key, contract_key]
      - type: foreign_key
        columns: [contract_key]
        to: ref('contract')
        to_columns: [contract_key]

    # tests:
    #   - dbt_utils.unique_combination_of_columns:
    #       combination_of_columns:
    #         - contract_key
    #         - medical_claim_key
    #         - diagnosis_sequence

    columns:
      # KEYS
      - name: contract_key
        description: "Contract Key."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: medical_claim_key
        description: "Claim ID."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: diagnosis_sequence
        description: "Sequence number of the diagnosis."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_key
        description: "Uniquely identifies the member."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      # DATES
      - name: start_date
        description: "Start date."
        data_type: date

      - name: end_date
        description: "End date."
        data_type: date

      - name: start_month
        description: "Month of claim start date."
        data_type: int

      - name: start_year
        description: "Year of claim start date."
        data_type: int

      # TERMINOLOGY CODES
      - name: diagnosis_code
        description: "Details about the ICD diagnosis, including the sequence number, code, and description."
        data_type: "struct<value: string, system: string, description: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: is_principal_diagnosis
        description: "Flag indicating that this diagnosis is the principal diagnosis code."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # OPERATIONAL CODES
      - name: clinical_program
        description: "Clinical Programs are the highest level of the HC clinical hierarchy and represent the service lines that exist within an organization."
        data_type: string

      - name: care_process_code
        description: "A Care Process is a key work process, a condition whose management is central to the work of the healthcare organization. This struct combines the Care Process with its higher-level Care Process Family and lower-level Sub Care Process."
        data_type: "struct<value: string, system: string, family: string, sub: string>"

      # METADATA
      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp

      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp
version: 2

models:
  - name: medical_claim_item

    description: The Claim Item concept contains claim row records associated with a Medical Claim record that itemize the services rendered.

    access: public

    versions:
      - v: 1

    config:
      enabled: true

    constraints:
      - type: primary_key
        columns: [contract_key, medical_claim_key, line_number]
      - type: foreign_key
        columns: [encounter_key]
        to: ref('encounter')
        to_columns: [encounter_key]
      - type: foreign_key
        columns: [encounter_item_key]
        to: ref('encounter_item')
        to_columns: [encounter_item_key]
      - type: foreign_key
        columns: [contract_key, medical_claim_key]
        to: ref('medical_claim')
        to_columns: [contract_key, medical_claim_key]
      - type: foreign_key
        columns: [member_key, contract_key]
        to: ref('member')
        to_columns: [member_key, contract_key]
      - type: foreign_key
        columns: [contract_key]
        to: ref('contract')
        to_columns: [contract_key]

    # tests:
    #   - dbt_utils.unique_combination_of_columns:
    #       combination_of_columns:
    #         - contract_key
    #         - medical_claim_key
    #         - line_number

    columns:
      # KEYS
      - name: contract_key
        description: "Contract Key."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: medical_claim_key
        description: "Claim Key."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: line_number
        description: "Line number."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_key
        description: "Uniquely identifies the member."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: encounter_key
        description: "The encounter key associated with the claim line item."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: encounter_item_key
        description: "The encounter item key associated with the claim line item."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: rendering_provider_key
        description: "The provider key of the rendering provider."
        data_type: string

      # DATES
      - name: claim_line_start_date
        description: "Claim line start date."
        data_type: date

      - name: claim_line_end_date
        description: "Claim line end date."
        data_type: date

      - name: claim_month
        description: "Claim month."
        data_type: int

      - name: claim_year
        description: "Claim year."
        data_type: int

      # TERMINOLOGY CODES
      - name: place_of_service_code
        description: "Place of service."
        data_type: "struct<value: string, system: string, description: string>"

      - name: revenue_center_code
        description: "Revenue center."
        data_type: "struct<value: string, system: string, description: string>"

      - name: hcpcs_cpt_code
        description: "Healthcare Common Procedure Coding System (HCPCS) code (includes Levels I, II, and III, if available)."
        data_type: "struct<value: string, system: string, description: string, modifier_01: string, modifier_02: string, modifier_03: string, modifier_04: string, modifier_05: string>"

      - name: principal_diagnosis_code
        description: "Principal ICD diagnosis."
        data_type: "struct<value: string, system: string, description: string>"

      - name: principal_procedure_code
        description: "Principal ICD procedure."
        data_type: "struct<value: string, system: string, description: string>"

      # OPERATIONAL CODES
      - name: claim_type_code
        description: "Type of claim being submitted through the payer's processing system."
        data_type: "struct<value: string, system: string, description: string, level_01: string, level_02: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: claim_category_code
        description: "Category code of claim being submitted through the payer's processing system."
        data_type: "struct<value: string, system: string, description: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: care_process_code
        description: "A Care Process Family is a group of related Care Processes; Care Process Families represent the middle level of the HC clinical hierarchy."
        data_type: "struct<value: string, system: string, family: string, sub: string>"

      - name: clinical_program
        description: "Clinical Programs are the highest level of the HC clinical hierarchy and represent the service lines that exist within an organization."
        data_type: string

      - name: original_claim_type_code
        description: "The original claim type that came from the claim source if it exists.  For many commerical sources this will be null."
        data_type: "struct<value: string, description: string>"

      # FINANCIALS
      - name: payment_status
        description: "Paid or denied."
        data_type: string
        tests:
          - not_null

      - name: payment_date
        description: "Date when the payment was made."
        data_type: date

      - name: charge_amount
        description: "Amount charged for the service or product."
        data_type: decimal(10,2)

      - name: allowed_amount
        description: "Maximum amount a plan will pay for a service."
        data_type: decimal(10,2)

      - name: paid_amount
        description: "Amount paid for the service or product."
        data_type: decimal(10,2)

      - name: coinsurance_amount
        description: "Amount the patient and insurance plan pay towards a service."
        data_type: decimal(10,2)

      - name: copay_amount
        description: "Fixed amount payed by a patient for a covered service."
        data_type: decimal(10,2)

      - name: deductible_amount
        description: "Amount of money payed before insurance coverage starts."
        data_type: decimal(10,2)

      - name: quantity
        description: "Number of units (e.g., days, visits, tests, etc.) of the item."
        data_type: decimal(10,2)

      - name: utilization_factor
        description: "Values can be 1, 0, -1. Can be used by utilization metrics to determine net values."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # OTHER
      - name: is_network_provider
        description: "Flag indicating whether the claim line item took place at a network provider."
        data_type: int

      - name: is_inpatient_admit
        description: "Flag indicating whether the encounter was an inpatient admission."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: is_elective_procedure
        description: "A flag to indicate if a procedure is elective."
        data_type: int

      # METADATA
      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp

      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp
version: 2

models:
  - name: medical_claim_procedure

    description: "This model contains details about procedures associated with a claim, including contract, member, and payer information."

    access: public

    versions:
      - v: 1

    config:
      enabled: true

    constraints:
      - type: primary_key
        columns: [contract_key, medical_claim_key, procedure_sequence]
      - type: foreign_key
        columns: [contract_key, medical_claim_key]
        to: ref('medical_claim')
        to_columns: [contract_key, medical_claim_key]

    # tests:
    #   - dbt_utils.unique_combination_of_columns:
    #       combination_of_columns:
    #         - contract_key
    #         - medical_claim_key
    #         - procedure_sequence

    columns:
      # KEYS
      - name: contract_key
        description: "Contract Key."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: medical_claim_key
        description: "Claim key"
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: procedure_sequence
        description: "The procedure code sequence."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # TERMINOLOGY CODES
      - name: procedure_code
        description: "Healthcare Common Procedure Coding System (HCPCS) code (includes Levels I, II, and III, if available)."
        data_type: "struct<value: string, system: string, description: string, modifier_01: string, modifier_02: string, modifier_03: string, modifier_04: string, modifier_05: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      # DATES
      - name: procedure_date
        description: "The date of the procedure."
        data_type: date

      # OTHER
      - name: is_primary_procedure
        description: "Flag indicating the code is the primary procedure code."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: is_elective_procedure
        description: "Flag indicating if a procedure is elective.  1 means yes, 0, means no, null is unknown."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # METADATA
      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp

      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp

version: 2

models:
  - name: member

    description: >
      The member concept represents a person who has received care or is part of the health care process in the context of a particular source system.
      An actual person may be represented by several member records if they have data spanning multiple coverages.

    access: public

    versions:
      - v: 1

    config:
      enabled: true

    constraints:
      - type: primary_key
        columns: [member_key, contract_key]
      - type: foreign_key
        columns: [contract_key]
        to: ref('contract')
        to_columns: [contract_key]

    # tests:
    #   - dbt_utils.unique_combination_of_columns:
    #       combination_of_columns:
    #         - member_key
    #         - contract_key

    columns:
      # KEYS
      - name: contract_key
        description: "Contract ID associated with member enrollment."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_key
        description: "Uniquely identifies the member."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: edw_patient_key
        description: "The master id for a person used to track a person across multiple member ids and link to clinical data in shared clinical."
        data_type: string

      # DEMOGRAPHICS
      - name: subscriber_id
        description: "Identifier for the primary subscriber of the insurance plan."
        data_type: string

      - name: member_name
        description: "Member full name."
        data_type: "struct<first: string, middle: string, last: string, suffix: string>"

      - name: city_name
        description: "Member city name."
        data_type: string

      - name: zip_code
        description: "Member zip code."
        data_type: string

      - name: county_code
        description: "Member county FIPS code."
        data_type: "struct<value: string, system: string, description: string>"

      - name: state_code
        description: "Member state code."
        data_type: "struct<value: string, system: string, description: string>"

      - name: country_code
        description: "Member country code."
        data_type: "struct<value: string, system: string, description: string>"

      - name: phone_number
        description: "Member phone number."
        data_type: string

      - name: gender_code
        description: "Member gender description."
        data_type: "struct<value: string, system: string, description: string>"

      - name: race_code
        description: "Member race code and description."
        data_type: "struct<value: string, system: string, description: string>"

      - name: ethnicity_code
        description: "Member ethnicity code and description."
        data_type: "struct<value: string, system: string, description: string>"

      - name: language_code
        description: "Member language code and description."
        data_type: "struct<value: string, system: string, description: string>"

      - name: marital_status_code
        description: "Member marital status code and description."
        data_type: "struct<value: string, system: string, description: string>"

      - name: religion
        description: "Member religion."
        data_type: string

      - name: ssn
        description: "Member social security number."
        data_type: string

      - name: mrn
        description: "Member medical record number."
        data_type: string

      # OPERATIONAL CODES
      - name: beneficiary_medicare_status_code
        description: "Status code and description indicating the reason for a beneficiary's entitlement to Medicare benefits."
        data_type: "struct<value: string, system: string, description: string>"

      - name: beneficiary_dual_status_code
        description: "Identifies the most recent entitlement status of beneficiaries eligible for programs in addition to Medicare (e.g., Medicaid), including a description."
        data_type: "struct<value: string, system: string, description: string>"

      - name: pcp_key
        description: "The National Provider Identifier (NPI) of the member's primary care provider."
        data_type: string

      # DATES
      - name: birth_date
        description: "Member birth date."
        data_type: date

      - name: death_date
        description: "Member death date."
        data_type: date

      - name: hospice_start_date
        description: "The member's most recent hospice start date or null."
        data_type: date

      - name: hospice_end_date
        description: "The member's most recent hospice end date or null."
        data_type: date

      # FLAGS
      - name: is_deceased
        description: "Flag indicating whether the member is deceased."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # METADATA
      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp

      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp
version: 2

models:
  - name: member_enrollment

    description: "This model tracks member enrollment details, including contract, payer, and organization information. It also captures the duration and attribution status of each member's enrollment."

    access: public

    versions:
      - v: 1

    config:
      enabled: true

    constraints:
      - type: primary_key
        columns: [member_key, contract_key, member_year, member_month]
      - type: foreign_key
        columns: [member_key, contract_key]
        to: ref('member')
        to_columns: [member_key, contract_key]
      - type: foreign_key
        columns: [contract_key]
        to: ref('contract')
        to_columns: [contract_key]

    # tests:
    #   - dbt_utils.unique_combination_of_columns:
    #       combination_of_columns:
    #         - member_key
    #         - contract_key
    #         - member_year
    #         - member_month

    columns:
      # KEYS
      - name: contract_key
        description: "Contract ID associated with member enrollment."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_key
        description: "Uniquely identifies the member."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      # DATES
      - name: member_year
        description: "Member year number."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_month
        description: "Member month number."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: member_month_start_date
        description: "Month and year transformed to a date using the first day of the month."
        data_type: date
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_month_end_date
        description: "Month and year transformed to a date using the last day of the month."
        data_type: date
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_quarter
        description: "Member quarter number."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # ATTRIBUTE

      - name: primary_care_provider_key
        description: "PCP provider  This is the member-selected PCP. Foreign key to the provider table."
        data_type: string

      - name: has_medical_coverage
        description: "Indicates if the coverage row includes medical coverage.  This will be True(Yes) if the source includes medical claims and does not provide a record to indicate otherwise.  Only persons with a True indicator should be included in medical utilization."
        data_type: boolean

      - name: has_pharmacy_coverage
        description: "Indicates if the coverage row includes pharmacy coverage.  This will be True(Yes) if the source includes pharmacy claims and does not provide a record to indicate otherwise.  Only persons with a True indicator should be included in pharmacy utilization."
        data_type: boolean

      - name: has_behavioral_coverage
        description: "Indicates if the coverage row includes behavioral health coverage.  This will be True(Yes) if the source includes behavioral health claims and does not provide a record to indicate otherwise.  Only persons with a True indicator should be included in behavioral health utilization."
        data_type: boolean

      - name: allows_data_sharing
        description: "Indicates if the person has specified that their information should not be shared.  These individuals may still be part of the population, but would not be included in utilization and claims should not be shared or included in any models."
        data_type: boolean

      - name: is_member_attributed
        description: "Flags that the record is tied to an attributed member of the population."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: age_at_month_start
        description: "The age of the member on the first day of the month."
        data_type: integer

      - name: report_grouper_01
        description: "Configurable field for selecting components of coverage attributes for reporting."
        data_type: string

      - name: report_grouper_02
        description: "Configurable field for selecting components of coverage attributes for reporting."
        data_type: string

      - name: report_grouper_03
        description: "Configurable field for selecting components of coverage attributes for reporting."
        data_type: string

      # METADATA
      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp

      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp
version: 2

models:
  - name: member_enrollment_history

    description: "This model provides a historical view of member enrollment, capturing details like contract information, payer and organization IDs, and attribution cohorts. It also includes timestamps and flags to track the status of members over time."

    access: public

    versions:
      - v: 1

    config:
      enabled: true

    constraints:
      - type: primary_key
        columns:
          [
            member_key,
            contract_key,
            member_year,
            member_month,
            member_attribution_cohort,
          ]
      - type: foreign_key
        columns: [member_key, contract_key]
        to: ref('member')
        to_columns: [member_key, contract_key]
      - type: foreign_key
        columns: [contract_key]
        to: ref('contract')
        to_columns: [contract_key]

    # tests:
    #   - dbt_utils.unique_combination_of_columns:
    #       combination_of_columns:
    #         - member_key
    #         - contract_key
    #         - member_year
    #         - member_month
    #         - member_attribution_cohort

    columns:
      # KEYS
      - name: contract_key
        description: "Contract ID associated with member enrollment."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_key
        description: "Uniquely identifies the member."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_attribution_cohort
        description: "Cohort description associated with member enrollment. Performance Year indicates attributed members for the specified year."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      # DATES
      - name: member_year
        description: "Member year number."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_month
        description: "Member month number."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_quarter
        description: "Member quarter number."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_month_start_date
        description: "Month and year transformed to a date using the first day of the month."
        data_type: date
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_month_end_date
        description: "Month and year transformed to a date using the last day of the month."
        data_type: date
        constraints:
          - type: not_null
        tests:
          - not_null

      # FLAGS
      - name: deceased_flag
        description: "Flag indicating whether the member is deceased."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      # METADATA
      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp

      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp
version: 2

models:
  - name: pharmacy_claim

    description: "This model contains details about pharmacy claims, including contract, payer, and drug information."

    access: public

    versions:
      - v: 1

    config:
      enabled: true

    constraints:
      - type: primary_key
        columns: [contract_key, pharmacy_claim_key, line_number]
      - type: foreign_key
        columns: [member_key, contract_key]
        to: ref('member')
        to_columns: [member_key, contract_key]
      - type: foreign_key
        columns: [contract_key]
        to: ref('contract')
        to_columns: [contract_key]

    # tests:
    #   - dbt_utils.unique_combination_of_columns:
    #       combination_of_columns:
    #         - contract_key
    #         - pharmacy_claim_key
    #         - line_number

    columns:
      # KEYS
      - name: contract_key
        description: "Contract key"
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: pharmacy_claim_key
        description: "Claim key."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: line_number
        description: "Line number."
        data_type: int
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: member_key
        description: "Uniquely identifies the member."
        data_type: string
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: pharmacy_provider_key
        description: "The provider key of the pharmacy."
        data_type: string

      - name: prescribing_provider_key
        description: "The provider key of the prescribing provider."
        data_type: string

      # TERMINOLOGY CODES
      - name: drug_code
        description: "National Drug Code (NDC) and its description."
        data_type: "struct<value: string, system: string, description: string>"

      # OPERATIONAL CODES
      - name: claim_category_code
        description: "Category of claim being submitted through the payer's processing system."
        data_type: "struct<value: string, system: string,description: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      - name: claim_type_code
        description: "Type of claim being submitted through the payer's processing system, with descriptive levels."
        data_type: "struct<value: string, system: string,level01_name: string, level02_name: string, description: string>"
        constraints:
          - type: not_null
        tests:
          - not_null

      # DATES
      - name: filled_date
        description: "The fill date of the prescription."
        data_type: date

      - name: paid_date
        description: "Prescription payment date"
        data_type: date

      - name: filled_month
        description: "Filled month number."
        data_type: int

      - name: filled_year
        description: "Filled year number."
        data_type: int

      # DISPENSING DETAILS
      - name: dispense_unit_count
        description: "Dispense unit count."
        data_type: decimal(10,2)

      - name: dispense_days_count
        description: "Dispense days count."
        data_type: int

      - name: prescription_id
        description: "Pharmacy identifier for the prescription."
        data_type: string

      - name: daw_code
        description: "Dispense as written code."
        data_type: string

      - name: prescription_fill_sequence
        description: "Prescription fill sequence."
        data_type: int

      # FINANCIALS
      - name: paid_amount
        description: "Amount paid for the service or product."
        data_type: decimal(10,2)

      - name: charge_amount
        description: "Amount charged for the service or product."
        data_type: decimal(10,2)

      - name: deductible_amount
        description: "Amount of money payed before insurance coverage starts."
        data_type: decimal(10,2)

      - name: allowed_amount
        description: "Maximum amount a plan will pay for a service."
        data_type: decimal(10,2)

      - name: copay_amount
        description: "Fixed amount payed by a patient for a covered service."
        data_type: decimal(10,2)

      - name: coinsurance_amount
        description: "Amount the patient and insurance plan pay towards a service."
        data_type: decimal(10,2)

      # OTHER
      - name: adjustment_type
        description: "Claim adjustment code."
        data_type: int

      # METADATA
      - name: meta_updated
        description: "Timestamp of the last update within this data product."
        data_type: timestamp

      - name: meta_created
        description: "Timestamp of the initial creation with this data product."
        data_type: timestamp
