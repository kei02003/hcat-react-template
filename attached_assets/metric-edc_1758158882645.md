<#Title#>

version: 1

models:
  - name: metric
    description: >
      The metric table holds summary level metric information that is not version or release specific

    access: public

    versions:
      - v: 1

    columns:
      KEYS
      - name: metric_key
        description: "Primary key for the table, the metric_key also serves as a foreign key to the metric_catalog.  It should be constructed using a short name of the metric with an underscore and owner name"
        data_type: string
        tests:
          - unique
          - not_null

      - name: metric
        description: "Name of the metric"
        data_type: string
        tests:
          - not_null

      - name: metric_description
        description: "Description of the metric"
        data_type: string
        tests:
          - not_null

      - name: tags
        description: "Applicable tags used for classifying the metric"
        data_type: json
version: 1

models:
  - name: metric_lineage
    description: >
      The metric_lineage table holds parent/child relationships between results

    access: public

    versions:
      - v: 1

    columns:
      KEYS
      - name: parent_result_key
        description: "Parent result"
        data_type: string

      - name: child_result_key
        description: "Child result"
        data_type: string

      - name: contribution_weight
        description: "Contribution weight"
        data_type: decimal
version: 1

models:
  - name: metric_version
    description: >
      The metric_version table holds version-specific metric information

    access: public

    versions:
      - v: 1

    columns:
      KEYS
      - name: metric_version_key
        description: "Unique identifier for this specific version of the metric"
        data_type: string
        tests:
          - unique
          - not_null

      - name: metric_key
        description: "Base identifier for the metric across all versions, foreign key to the metric table"
        data_type: string
        tests:
          - not_null

      - name: version_number
        description: "Version number or identifier for this metric definition"
        data_type: string
        tests:
          - not_null

      - name: valid_from_datetime
        description: "Date and time when this version becomes valid/active"
        data_type: datetime

      - name: valid_to_datetime
        description: "Date and time when this version expires or becomes inactive"
        data_type: datetime

      - name: metric_version_name
        description: "Human-readable name of the metric"
        data_type: string
        tests:
          - not_null

      - name: metric_version_description
        description: "Detailed description of what the metric measures"
        data_type: string
        tests:
          - not_null

      - name: grain
        description: "Map type of the grain of the metric result"
        data_type: map<string,string>
        tests:
          - not_null

      - name: grain_description
        description: "Text description of the grain"

      - name: domain
        description: "Domain or area that owns this metric (e.g., Clinical, Claim, Billing)"
        data_type: string
        tests:
          - not_null

      - name: result_type
        description: "Data type of the metric result (numeric, text, boolean, etc.)"
        data_type: string

      - name: result_unit
        description: "Unit of measurement for the metric result (e.g., dollars, percent, count)"
        data_type: string

      - name: frequency
        description: "How often the metric is calculated or updated (e.g., daily, weekly, monthly)"
        data_type: string

      - name: source_category
        description: "Category or type of data source used for this metric"
        data_type: string

      - name: is_regulatory
        description: "Indicates whether this metric is required for regulatory compliance"
        data_type: boolean

      - name: regulatory_program
        description: "Name of the regulatory program or framework this metric supports"
        data_type: string

      - name: steward
        description: "Person or role responsible for the business definition and quality of this metric"
        data_type: string
        tests:
          - not_null

      - name: developer
        description: "Person or team responsible for implementing and maintaining the metric calculation"
        data_type: string
        tests:
          - not_null

      - name: is_active
        description: "Flag indicating whether this metric version is currently active"
        data_type: boolean

      - name: metadata_schema
        description: "JSON schema defining the structure of required metadata for this metric"
        data_type: json

      - name: required_metadata_fields
        description: "List of mandatory metadata fields that must be provided with metric results"
        data_type: json

      - name: created_datetime
        description: "Timestamp when this metric definition record was created"
        data_type: datetime

      - name: updated_datetime
        description: "Timestamp when this metric definition record was last updated"
        data_type: datetime
version: 1

models:
  - name: result
    description: >
      The result table holds metric result data loaded from the staging_result table, this table merges data in from staging_result and will update results where keys overlap

    access: public
    config:
      materialized: table
    versions:
      - v: 1

    columns:
      KEYS
      - name: result_key
        description: "Unique identifier for the metric result"
        data_type: string

      - name: grain_keys
        description: "Map type object containing key-value pairs that define the grain dimensions"
        data_type: map<string,string>

      - name: metric_version_key
        description: "Foreign key reference to the metric definition version"
        data_type: string

      - name: result_value_numeric
        description: "Numeric value of the metric result"
        data_type: decimal

      - name: result_value_datetime
        description: "Date/time value of the metric result"
        data_type: datetime

      - name: result_value_text
        description: "Text/string value of the metric result"
        data_type: string

      - name: result_value_boolean
        description: "Boolean (true/false) value of the metric result"
        data_type: boolean

      - name: result_value_json
        description: "Complex JSON value of the metric result"
        data_type: json

      - name: measurement_period_start_datetime
        description: "Start date/time of the measurement period for this result"
        data_type: datetime

      - name: measurement_period_end_datetime
        description: "End date/time of the measurement period for this result"
        data_type: datetime

      - name: as_of_datetime
        description: "Point-in-time when this metric result was captured or valid"
        data_type: datetime

      - name: result_metadata
        description: "Additional metadata about the metric result in JSON format"
        data_type: json

      - name: calculated_at
        description: "Timestamp when the metric result was calculated"
        data_type: datetime

      - name: calculation_version
        description: "Version identifier of the calculation logic used"
        data_type: string
version: 1

models:
  - name: staging_result
    description: >
      The staging_result table holds all result data loaded from metric logic, this table is append-only and will be purged periodically

    access: public
    config:
      materialized: table
    versions:
      - v: 1

    columns:
      KEYS
      - name: result_key
        description: "Unique identifier for the metric result"
        data_type: string

      - name: grain_keys
        description: "Map type object containing key-value pairs that define the grain dimensions"
        data_type: map<string,string>

      - name: metric_version_key
        description: "Foreign key reference to the metric definition version"
        data_type: string

      - name: result_value_numeric
        description: "Numeric value of the metric result"
        data_type: decimal

      - name: result_value_datetime
        description: "Date/time value of the metric result"
        data_type: datetime

      - name: result_value_text
        description: "Text/string value of the metric result"
        data_type: string

      - name: result_value_boolean
        description: "Boolean (true/false) value of the metric result"
        data_type: boolean

      - name: result_value_json
        description: "Complex JSON value of the metric result"
        data_type: json

      - name: measurement_period_start_datetime
        description: "Start date/time of the measurement period for this result"
        data_type: datetime

      - name: measurement_period_end_datetime
        description: "End date/time of the measurement period for this result"
        data_type: datetime

      - name: as_of_datetime
        description: "Point-in-time when this metric result was captured or valid"
        data_type: datetime

      - name: result_metadata
        description: "Additional metadata about the metric result in JSON format"
        data_type: json

      - name: calculated_at
        description: "Timestamp when the metric result was calculated"
        data_type: datetime

      - name: calculation_version
        description: "Version identifier of the calculation logic used"
        data_type: string
